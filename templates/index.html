{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="app-layout">
        <!-- Input Panel -->
        <section class="input-panel">
            <h2 class="panel-title">
                <i class="fas fa-keyboard"></i>
                Input Text
            </h2>
            
            <!-- Model Selection -->
            <div class="form-group">
                <label for="modelSelect">Select Model:</label>
                <select id="modelSelect" class="form-control">
                    {% for model_id, model_info in models.items() %}
                    <option value="{{ model_id }}" {% if model_id == default_model %}selected{% endif %}>
                        {{ model_info.display_name }} - {{ model_info.description }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <!-- Text Input Methods -->
            <div class="input-tabs">
                <button class="tab-btn active" data-tab="text">
                    <i class="fas fa-edit"></i> Type Text
                </button>
                <button class="tab-btn" data-tab="file">
                    <i class="fas fa-file-upload"></i> Upload File
                </button>
                <button class="tab-btn" data-tab="examples">
                    <i class="fas fa-book"></i> Examples
                </button>
            </div>
            
            <!-- Text Input Tab -->
            <div class="tab-content active" id="textTab">
                <div class="form-group">
                    <textarea 
                        id="textInput" 
                        class="form-control text-input" 
                        placeholder="Enter your text here... (e.g., 'The quick brown fox jumps over the lazy dog.')"
                        rows="6"
                    ></textarea>
                    <div class="text-counter">
                        <span id="charCount">0</span> characters | 
                        <span id="wordCount">0</span> words |
                        <span id="tokenEstimate" class="token-estimate">~0 tokens</span>
                        <div id="tokenWarning" class="token-warning" style="display: none;">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>Approaching token limit (512 max)</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- File Upload Tab -->
            <div class="tab-content" id="fileTab">
                <div class="file-upload-area">
                    <input type="file" id="fileInput" accept=".txt,.md" hidden>
                    <label for="fileInput" class="file-upload-label">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <span>Click to upload or drag and drop</span>
                        <small>Supported: .txt, .md (max 5MB)</small>
                    </label>
                    <div id="fileInfo" class="file-info"></div>
                </div>
            </div>
            
            <!-- Examples Tab -->
            <div class="tab-content" id="examplesTab">
                <div class="examples-grid" id="examplesGrid">
                    <!-- Examples will be loaded dynamically -->
                </div>
            </div>
            
            <!-- Process Button -->
            <button id="processBtn" class="btn btn-primary btn-large">
                <i class="fas fa-play"></i>
                Process Text
            </button>
        </section>
        
        <!-- Visualization Panel -->
        <section class="visualization-panel">
            <div class="viz-header">
                <h2 class="panel-title">
                    <i class="fas fa-project-diagram"></i>
                    Neural Network Visualization
                </h2>
                <div class="viz-controls" style="display: none;">
                    <!-- Controls moved to floating panel -->
                </div>
            </div>
            
            <!-- Visualization Container -->
            <div id="vizContainer" class="viz-container">
                <!-- Floating Visualization Controls -->
                <div class="viz-floating-controls" style="display: none;">
                    <div class="floating-mode-selector">
                        <button class="floating-mode-btn active" data-mode="network" title="Network Graph">
                            <i class="fas fa-project-diagram"></i>
                        </button>
                        <button class="floating-mode-btn" data-mode="attention" title="Attention Heatmap">
                            <i class="fas fa-th"></i>
                        </button>
                        <button class="floating-mode-btn" data-mode="embedding" title="Embedding Space">
                            <i class="fas fa-cube"></i>
                        </button>
                        <button class="floating-mode-btn" data-mode="flow" title="Layer Flow">
                            <i class="fas fa-layer-group"></i>
                        </button>
                    </div>
                    <button class="floating-perf-btn" title="Performance Mode (Auto)">
                        <i class="fas fa-tachometer-alt"></i>
                    </button>
                    <button class="floating-export-btn" id="exportBtn" title="Export">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="floating-fullscreen-btn" id="fullscreenBtn" title="Fullscreen">
                        <i class="fas fa-expand"></i>
                    </button>
                    <button class="floating-toggle-btn" title="Toggle Controls">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
                
                <div class="viz-placeholder">
                    <i class="fas fa-brain fa-4x"></i>
                    <h3>Ready to Visualize</h3>
                    <p>Enter text and click "Process Text" to see the neural network visualization</p>
                </div>
            </div>
            <!-- Info Panel -->
            <div class="info-panel" id="infoPanel">
                <h3>Model Information</h3>
                <div id="modelInfo" class="model-info">
                    <!-- Model info will be displayed here -->
                </div>
                <h3>Processing Results</h3>
                <div id="processingResults" class="processing-results">
                    <!-- Results will be displayed here -->
                </div>
            </div>
        </section>
    </div>
</div>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay">
    <div class="loader">
        <div class="loader-spinner"></div>
        <p>Processing text through neural network...</p>
        <p style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 8px;">Longer texts may take a few seconds</p>
    </div>
</div>

<!-- Help Modal -->
<div id="helpModal" class="modal help-modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3><i class="fas fa-question-circle"></i> Neural Echo Help Guide</h3>
            <button class="modal-close" onclick="closeHelpModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body help-content">
            <div class="help-section">
                <h4>üöÄ Getting Started</h4>
                <ol>
                    <li><strong>Enter Text:</strong> Type or paste text into the input field (up to 512 tokens)</li>
                    <li><strong>Select Model:</strong> Choose between DistilBERT or GPT-2 for different analysis perspectives</li>
                    <li><strong>Process:</strong> Click "Process Text" to analyze your text</li>
                    <li><strong>Explore:</strong> Use the floating controls to switch between visualization modes</li>
                </ol>
            </div>
            
            <div class="help-section">
                <h4>üé® Visualization Modes</h4>
                <div class="help-grid">
                    <div class="help-item">
                        <div class="help-icon"><i class="fas fa-project-diagram"></i></div>
                        <h5>Network Graph</h5>
                        <p>Shows attention connections between tokens as an interactive force-directed graph. Drag nodes to explore relationships.</p>
                    </div>
                    <div class="help-item">
                        <div class="help-icon"><i class="fas fa-th"></i></div>
                        <h5>Attention Heatmap</h5>
                        <p>Displays attention weights as a matrix. Navigate through layers and attention heads to see how tokens focus on each other.</p>
                    </div>
                    <div class="help-item">
                        <div class="help-icon"><i class="fas fa-cube"></i></div>
                        <h5>3D Embedding Space</h5>
                        <p>Visualizes token embeddings in 3D space. Similar tokens cluster together. Rotate and zoom to explore semantic relationships.</p>
                    </div>
                    <div class="help-item">
                        <div class="help-icon"><i class="fas fa-layer-group"></i></div>
                        <h5>Layer Flow</h5>
                        <p>Shows how tokens transform through the neural network layers. Watch the animated progression to understand processing depth.</p>
                    </div>
                </div>
            </div>
            
            <div class="help-section">
                <h4>‚å®Ô∏è Controls & Shortcuts</h4>
                <table class="help-table">
                    <tr>
                        <th>Action</th>
                        <th>Control</th>
                    </tr>
                    <tr>
                        <td>Zoom In/Out</td>
                        <td>Mouse wheel or pinch</td>
                    </tr>
                    <tr>
                        <td>Pan View</td>
                        <td>Click and drag (2D) or right-click drag (3D)</td>
                    </tr>
                    <tr>
                        <td>Rotate (3D)</td>
                        <td>Left-click and drag</td>
                    </tr>
                    <tr>
                        <td>Select Node</td>
                        <td>Click on node</td>
                    </tr>
                    <tr>
                        <td>View Details</td>
                        <td>Hover over elements</td>
                    </tr>
                    <tr>
                        <td>Fullscreen</td>
                        <td>F key or fullscreen button</td>
                    </tr>
                    <tr>
                        <td>Export</td>
                        <td>Export button ‚Üí PNG or JSON</td>
                    </tr>
                </table>
            </div>
            
            <div class="help-section">
                <h4>üí° Tips & Best Practices</h4>
                <ul>
                    <li><strong>Optimal Text Length:</strong> 50-200 tokens work best for interactive exploration</li>
                    <li><strong>Performance Mode:</strong> Use the speedometer button to switch between quality and speed</li>
                    <li><strong>Token Colors:</strong> Different colors represent token types (special, capitalized, numbers, punctuation, words)</li>
                    <li><strong>Large Texts:</strong> For texts over 300 tokens, the app automatically optimizes for performance</li>
                    <li><strong>Model Differences:</strong> DistilBERT focuses on bidirectional understanding, GPT-2 on forward prediction</li>
                </ul>
            </div>
            
            <div class="help-section">
                <h4>üîß Troubleshooting</h4>
                <ul>
                    <li><strong>Slow Performance?</strong> Try enabling Performance Mode or reducing text length</li>
                    <li><strong>Visualization Not Loading?</strong> Refresh the page and ensure JavaScript is enabled</li>
                    <li><strong>Export Not Working?</strong> Check browser permissions for downloads</li>
                    <li><strong>Text Truncated?</strong> Maximum limit is 512 tokens (approximately 2000 characters)</li>
                </ul>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" onclick="closeHelpModal()">Got it!</button>
        </div>
    </div>
</div>

<!-- Error Modal -->
<div id="errorModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-exclamation-triangle"></i> Error</h3>
            <button class="modal-close" onclick="closeErrorModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body" id="errorMessage">
            <!-- Error message will be displayed here -->
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeErrorModal()">Close</button>
        </div>
    </div>
</div>
{% endblock %}
